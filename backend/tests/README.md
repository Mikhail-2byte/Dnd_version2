# Тесты Backend

## Запуск тестов

```bash
# Все тесты
pytest

# С покрытием
pytest --cov=app --cov-report=html

# Конкретный файл
pytest tests/test_characters.py

# Конкретный тест
pytest tests/test_characters.py::test_create_character

# С verbose выводом
pytest -v
```

## Структура тестов

### test_auth.py
- Регистрация пользователя
- Вход в систему
- Получение текущего пользователя
- Валидация токенов

### test_games.py
- Создание игры
- Получение игры по invite-коду
- Присоединение к игре
- Управление токенами

### test_characters.py
- Создание персонажа
- Получение персонажей
- Обновление персонажа
- Удаление персонажа
- Проверка прав доступа

### test_dice.py
- Бросок кубиков
- Валидация параметров
- Различные типы кубиков
- Проверка результатов

### test_models.py
- Создание моделей
- Связи между моделями
- Валидация данных

### test_websocket.py
- Подключение WebSocket
- События игры
- Управление токенами через WebSocket
- Бросок кубиков через WebSocket

## Фикстуры

- `client` - тестовый FastAPI клиент
- `db_session` - сессия БД для тестов
- `test_user` - тестовый пользователь
- `test_user_token` - JWT токен для тестового пользователя
- `auth_headers` - заголовки с токеном
- `test_game` - тестовая игра
- `test_token` - тестовый токен
- `mock_redis` - мок Redis

## Примечания

- Все тесты используют SQLite в памяти
- Redis мокируется для тестов
- WebSocket тесты требуют дополнительной настройки
